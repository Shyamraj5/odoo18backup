<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <t t-inherit="pos_self_order.ProductListPage" t-inherit-mode="extension">
        <xpath expr="//div[@class='d-flex flex-column vh-100 overflow-hidden']" position="replace">
            <div class="container">
                <img t-attf-src="/web/image/res.company/{{ state.company.id }}/logo" style="height:50px" alt="Company logo" t-if="state.company.id"/>
            </div>
            <div t-if="this.selfOrder.showProductCategories" class="container mt-2 flex-grow-1 overflow-y-auto">
                <div class="row g-1 mt-1">
                    <div 
                        t-foreach="selfOrder.availableCategories" 
                        t-as="category" 
                        t-key="category.id"
                        t-ref="category_{{category.id}}"
                        t-on-click="() => toggleVisibility(category.id)"
                        class="col-4 col-md-3 col-lg-2 p-1">
                        <div class="card text-center shadow-sm rounded-3 overflow-hidden position-relative"
                            style="max-width: 120px; cursor: pointer;">
                            <!-- Category Image -->
                            <t t-if="category.has_image">
                                <img class="rounded w-100" style="height: 100px; object-fit: cover;"
                                    t-attf-src="/web/image/pos.category/{{ category.id }}/image_128"
                                    alt="Product image"
                                    loading="lazy"
                                    onerror="this.remove()" />
                            </t>
                            <t t-else="">
                                <div class="d-flex align-items-center justify-content-center"
                                    style="height: 100px; background-color: #f8f9fa;">
                                    <i class="fa fa-cutlery fa-lg text-secondary"></i>
                                </div>
                            </t>

                            <!-- Category Details -->
                            <div class="card-body p-1">
                                <h6 class="card-title text-truncate text-small" style="font-size: 12px; max-width: 100%;">
                                    <t t-esc="category.name" />
                                </h6>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div t-if="this.selfOrder.showProducts" class="container mt-4">
                <button 
                    t-attf-class="cart btn btn-md flex-grow-1 flex-md-grow-0 fa fa-caret-left"
                    style="background-color:#123732;color:white"
                    t-on-click="showProductCategories">
                    Categories
                </button>
            </div>
            <div t-if="this.selfOrder.showProducts" class="container mt-4 overflow-hidden d-flex flex-column vh-100">
                <div
                    id="scrollspy-products"
                    class="product-list position-relative flex-grow-1 overflow-y-auto"
                    t-ref="productsList"
                    data-bs-spy="scroll"
                    data-bs-target="#listgroup-categories"
                    data-bs-offset="10"
                    tabindex="0">
                    <t t-set="nbrItem" t-value="0" />
                    <section
                        t-foreach="state.currentProductCategory"
                        t-as="category"
                        t-key="category.id"
                        t-attf-id="scrollspy_{{category.id}}"
                        t-attf-categId="{{category.id}}"
                        t-ref="productsWithCategory_{{category.id}}"
                        class="product-list-category d-empty-none bg-view px-3 pb-4">
                        <t t-set="products" t-value="this.selfOrder.productByCategIds[category.id] || []" />
                        <t t-set="availableProducts" t-value="products" />
                        <t t-set="nbrItem" t-value="availableProducts.length + nbrItem" />
                        <t t-if="availableProducts.length > 0">
                            <div class="pt-4 pb-2 px-3 mb-4 mx-n3 bg-200 fw-bold">
                                <h2 t-esc="category.name"/>
                                <span t-if="!selfOrder.isCategoryAvailable(category.id)" class="unavailable-text">Unavailable at this time of the day</span>
                            </div>
                            <div class="o-so-products-row">
                                <t t-foreach="availableProducts" t-as="product" t-key="product.id">
                                    <ProductCard product="product" currentProductCard="product.id === selfOrder.lastEditedProductId and currentProductCard" />
                                </t>
                            </div>
                        </t>
                    </section>
                    <p t-if="nbrItem === 0" class="mx-auto mt-3 text-center">No products found</p>
                </div>
            </div>
            <div class="container" t-if="this.selfOrder.showProducts || this.selfOrder.currentOrder.unsentLines.length > 0">
                <!-- Page buttons -->
                <OrderWidget t-if="this.selfOrder.ordering" action.bind="review" />
            </div>
        </xpath>
    </t>
</templates>