<odoo>
    <template id="daily_meals_report_template">
    <t t-call="web.html_container">
        <t t-call="diet.daily_meals_report_header">
            <div class="page" style="font-size:16px;">
                <div class="row" style="font-size:24px;background-color:#8bc388;padding:7px;">
                    <div class="col-6" style="text-align:center;">
                        <font color="white">
                            <strong>MEALS DAILY REPORT</strong>
                        </font>
                    </div>
                    <div class="col-6" style="text-align:center;">
                        <font color="white">
                            <strong>Date : <t t-esc="date"/></strong>
                        </font>
                    </div>
                </div>
                <t t-foreach="calendar" t-as="plan">
                    <t t-set="sum_meals" t-value="0"/>
                    <t t-set="sum_portion_one" t-value="0"/>
                    <t t-set="sum_portion_one_half" t-value="0"/>
                    <t t-set="sum_portion_two" t-value="0"/>
                    <t t-set="sum_portion_total" t-value="0"/>
                    <table class="table table-bordered" style="border:2px solid black;padding:10px;border-collapse:collapse;margin-top:20px;page-break-inside:avoid;">
                        <thead>
                            <tr style="background-color:#8bc388;border-right:1px solid black;border-left:1px solid black;border-collapse:collapse;border-bottom:1px solid black;">
                                <th colspan="8" style="text-align:left;padding:10px;border-left:1px solid black; border-top:1px solid black;border-bottom:1px solid black; border-collapse:collapse">
                                    <t t-esc="plan.upper()"/>
                                </th>
                            </tr>
                        </thead>
                        <tr style="text-align:center;font-weight:bold;border-right:1px solid black;border-left:1px solid black;border-collapse:collapse;border-bottom:1px solid black;background-color:#b7dfa9;">
                            <td>NO</td>
                            <td>CODE</td>
                            <td>MEAL</td>
                            <td>PERSONS</td>
                            <td>1</td>
                            <td>1.5</td>
                            <td>2</td>
                            <td>TOTAL PORTIONS</td>
                        </tr>
                        <t t-set="no" t-value="0"/>
                        <t t-foreach="calendar[plan]" t-as="meal_cat">
                            <tr style="border-right:1px solid black;border-left:1px solid black;border-collapse:collapse;border-bottom:1px solid black;font-weight:bold;">
                                <td colspan="8" style="text-align:left;padding:10px;border-left:1px solid black; border-top:1px solid black;border-bottom:1px solid black; border-collapse:collapse">
                                    <t t-esc="meal_cat.upper()"/>
                                </td>     
                            </tr>
                            <t t-foreach="calendar[plan][meal_cat]" t-as="recipe">
                                <t t-set="no" t-value="no+1"/>
                                <tr style="border-bottom:1px solid black;border-right:1px solid black;border-left:1px solid black;border-collapse:collapse;border-bottom:1px solid black;">
                                        <t t-set="length_dislike" t-value="0"/>
                                        <t t-foreach="calendar[plan][meal_cat][recipe]" t-as="item">
                                            <t t-foreach="calendar[plan][meal_cat][recipe][item]['dislike']" t-as="dl">
                                                <t t-if="dl">
                                                    <t t-set="length_dislike" t-value="length_dislike + 1"/>
                                                </t>
                                            </t>
                                        </t>
                                        <td t-att-rowspan="length_dislike + 1" style="vertical-align:middle;text-align:center;" ><t t-esc="no"/></td>
                                        <td t-att-rowspan="length_dislike + 1" style="vertical-align:middle;text-align:center;"><t t-esc="recipe"/></td>

                                        
                                        <t t-foreach="calendar[plan][meal_cat][recipe]" t-as="item">
                                            <td><t t-esc="item"/></td>
                                            <td style="text-align:right;font-weight:bold;"><t t-esc="calendar[plan][meal_cat][recipe][item]['qty']"/></td>
                                            <td style="text-align:right;font-weight:bold;"><t t-esc="calendar[plan][meal_cat][recipe][item]['1']"/></td>
                                            <td style="text-align:right;font-weight:bold;"><t t-esc="calendar[plan][meal_cat][recipe][item]['1.5']"/></td>
                                            <td style="text-align:right;font-weight:bold;"><t t-esc="calendar[plan][meal_cat][recipe][item]['2']"/></td>
                                            <t t-set="total_portion" t-value="calendar[plan][meal_cat][recipe][item]['1'] + (1.5 *calendar[plan][meal_cat][recipe][item]['1.5']) + (2*calendar[plan][meal_cat][recipe][item]['2'])"/>
                                            <td style="text-align:right;font-weight:bold;"><t t-esc="total_portion"/></td>
                                            <t t-set="sum_meals" t-value="sum_meals + calendar[plan][meal_cat][recipe][item]['qty']"/>
                                            <t t-set="sum_portion_one" t-value="sum_portion_one + calendar[plan][meal_cat][recipe][item]['1']"/>
                                            <t t-set="sum_portion_one_half" t-value="sum_portion_one_half + calendar[plan][meal_cat][recipe][item]['1.5']"/>
                                            <t t-set="sum_portion_two" t-value="sum_portion_two + calendar[plan][meal_cat][recipe][item]['2']"/>
                                            <t t-set="sum_portion_total" t-value="sum_portion_total +total_portion"/>
                                            <t t-foreach="calendar[plan][meal_cat][recipe][item]['dislike']" t-as="dl">
                                                <t t-if="dl">
                                                <tr style="border-bottom:1px solid black;border-right:1px solid black;border-left:1px solid black;border-collapse:collapse;border-bottom:1px solid black;">
                                                    <td style="text-align:right;">Avoid <t t-esc="dl"/></td>
                                                    <td style="text-align:right;"><t t-esc="calendar[plan][meal_cat][recipe][item]['dislike'][dl]['count']"/></td>
                                                    <td style="text-align:right;"><t t-esc="calendar[plan][meal_cat][recipe][item]['dislike'][dl]['1']"/></td>
                                                    <td style="text-align:right;"><t t-esc="calendar[plan][meal_cat][recipe][item]['dislike'][dl]['1.5']"/></td>
                                                    <td style="text-align:right;"><t t-esc="calendar[plan][meal_cat][recipe][item]['dislike'][dl]['2']"/></td>
                                                    <t t-set="total_portions" t-value="calendar[plan][meal_cat][recipe][item]['dislike'][dl]['1'] + (1.5 *calendar[plan][meal_cat][recipe][item]['dislike'][dl]['1.5']) + (2*calendar[plan][meal_cat][recipe][item]['dislike'][dl]['2'])"/>
                                                    <td style="text-align:right;"><t t-esc="total_portions"/></td>
                                                </tr>
                                                </t>
                                            </t>
                                        </t>
                                    </tr>
                            </t>                
                        </t>
                        <tr style="text-align:right;">
                            <td colspan="3"><strong>Total</strong></td>
                            <td style="font-weight:bold;"><t t-esc="sum_meals"/></td>
                            <td style="font-weight:bold;"><t t-esc="sum_portion_one"/></td>
                            <td style="font-weight:bold;"><t t-esc="sum_portion_one_half"/></td>
                            <td style="font-weight:bold;"><t t-esc="sum_portion_two"/></td>
                            <td style="font-weight:bold;"><t t-esc="sum_portion_total"/></td>
                        </tr>
                        
                    </table>
                </t>
                <div style="page-break-inside:avoid;">            
                    <div class="row">
                        <div class="col-6"/>
                        <div class="col-4" style="text-align:right; padding:5px;">
                            <strong>TOTAL PERSONS</strong>
                        </div>
                        <div class="col-2" style="text-align:right;padding:5px;">
                            <b><t t-esc="persons"/></b>
                        </div>
                    </div>
                    <t t-foreach="plan_summary" t-as="plan">
                        <div class="row">
                            <div class="col-6"/>
                            <div class="col-4" style="text-align:right;padding:5px;">
                                <t t-esc="plan"/>
                            </div>
                            <div class="col-2" style="text-align:right;padding:5px;">
                                <t t-esc="plan_summary[plan]"/>
                            </div>
                        </div>
                    </t>
                </div>
            </div>
            <div>
                <div class="row" style="page-break-inside:avoid;">
                    <div class="col-6"/>
                    <div class="col-4" style="text-align:right; padding:5px;">
                        <strong>TOTAL MEALS</strong>
                    </div>
                    <div class="col-2" style="text-align:right;padding:5px;">
                        <b><t t-esc="meals_count"/></b>
                    </div>
                </div>
                <t t-foreach="meal_summary" t-as="meal">
                    <div class="row">
                        <div class="col-6"/>
                        <div class="col-4" style="text-align:right;padding:5px;">
                            <t t-esc="meal"/>
                        </div>
                        <div class="col-2" style="text-align:right;padding:5px;">
                            <t t-esc="meal_summary[meal]"/>
                        </div>
                    </div>
                </t>
            </div>
        </t>
    </t>
</template>

</odoo>
