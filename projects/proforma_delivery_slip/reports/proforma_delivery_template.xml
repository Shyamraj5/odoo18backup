<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Main Report Template -->
        <template id="report_proforma_delivery_slip">
            <t t-foreach="docs" t-as="o">
                <t t-call="proforma_delivery_slip.report_proforma_delivery_slip_document" t-lang="o.partner_id.lang"/>
            </t>
        </template>

        <!-- Document Template -->
        <template id="report_proforma_delivery_slip_document">
            <t t-call="web.html_container">
                <t t-call="web.external_layout">
                    <t t-set="o" t-value="o.with_context(lang=o.partner_id.lang)" />
                    <t t-set="partner" t-value="o.partner_id"/>

                    <t t-set="address">
                        <div name="div_outgoing_address">
                            <div name="outgoing_delivery_address">
                                <span><strong>Delivery Address:</strong></span>
                                <div t-field="o.partner_shipping_id"
                                    t-options='{"widget": "contact", "fields": ["address", "name", "phone"], "no_marker": True, "phone_icons": True}'/>
                            </div>
                        </div>
                    </t>
                    <t t-set="information_block">
                        <div class="row">
                            <div class="col-7" name="div_customer_address">
                                <div name="customer_address" t-if="partner and partner != partner.commercial_partner_id">
                                    <strong>Customer Address</strong>
                                </div>
                                <div name="partner_header">
                                    <div t-field="partner.commercial_partner_id"
                                         t-options='{"widget": "contact", "fields": ["address", "name", "phone", "vat"], "no_marker": True, "phone_icons": True}'/>
                                </div>
                            </div>
                        </div>
                    </t>
                    <div class="page">
                        <h2>
                            <span>Proforma Delivery Slip - </span><span t-field="o.name">SO001</span>
                        </h2>
                        <div class="oe_structure"></div>
                        <div id="informations" class="report-wrapping-flexbox clearfix row mb-4">
                            <div t-if="o.name" class="col col-3 mw-100 mb-2" name="div_origin">
                                <strong>Order</strong>
                                <div t-field="o.name" class="m-0">SO001</div>
                            </div>
                            <div t-if="o.date_order" class="col col-3 mw-100 mb-2" name="div_sched_date">
                                <strong>Order Date</strong>
                                <div t-field="o.date_order" t-options='{"widget": "date"}' class="m-0"/>
                            </div>
                            <div t-if="o.commitment_date" class="col col-3 mw-100 mb-2" name="div_delivery_date">
                                <strong>Expected Delivery</strong>
                                <div t-field="o.commitment_date" t-options='{"widget": "date"}' class="m-0"/>
                            </div>
                            <div t-if="o.user_id.name" class="col col-3 mw-100 mb-2">
                                <strong>Salesperson</strong>
                                <div t-field="o.user_id" class="m-0">Mitchell Admin</div>
                            </div>
                        </div>
                        <div class="oe_structure"></div>
                        <table class="table table-borderless" name="stock_move_table">
                            <thead>
                                <tr>
                                    <th name="th_sm_product">Product</th>
                                    <th name="th_sm_ordered" class="text-end">Ordered</th>
                                    <th name="th_sm_quantity" class="text-end">To Deliver</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-set="lines" t-value="o.order_line.filtered(lambda x: not x.display_type and x.product_uom_qty > 0)"/>
                                <tr t-foreach="lines" t-as="line">
                                    <td>
                                        <span t-field="line.product_id">Customizable Desk</span>
                                        <p t-if="line.name and line.name != line.product_id.name and line.name != line.product_id.display_name">
                                            <span t-field="line.name">Description on order</span>
                                        </p>
                                    </td>
                                    <td class="text-end">
                                        <span t-field="line.product_uom_qty">3.00</span>
                                        <span t-field="line.product_uom" groups="uom.group_uom">units</span>
                                        <span t-if="line.product_packaging_id">
                                            (<span t-field="line.product_packaging_qty" t-options='{"widget": "integer"}'/> <span t-field="line.product_packaging_id"/>)
                                        </span>
                                    </td>
                                    <td class="text-end">
                                        <span t-field="line.product_uom_qty">3.00</span>
                                        <span t-field="line.product_uom" groups="uom.group_uom">units</span>
                                        <span t-if="line.product_packaging_id">
                                            (<span t-field="line.product_packaging_qty" t-options='{"widget": "integer"}'/> <span t-field="line.product_packaging_id"/>)
                                        </span>
                                    </td>
                                </tr>
                                
                                <!-- Handle display_type lines (sections and notes) -->
                                <t t-set="display_lines" t-value="o.order_line.filtered(lambda x: x.display_type)"/>
                                <t t-foreach="display_lines" t-as="line">
                                    <tr t-if="line.display_type == 'line_section'" t-att-class="'fw-bold o_line_section'">
                                        <td colspan="99">
                                            <span t-field="line.name">A section title</span>
                                        </td>
                                    </tr>
                                    <tr t-if="line.display_type == 'line_note'">
                                        <td colspan="99">
                                            <span t-field="line.name">A note</span>
                                        </td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>
                        <div class="oe_structure"></div>

                        <!-- Proforma Notice -->
                        <div class="mt-5">
                            <p class="text-muted">
                                <strong>Note:</strong> This is a proforma delivery slip for planning purposes only.
                                Actual delivery quantities and dates may vary based on product availability and logistics.
                                Please confirm delivery details before final shipment.
                            </p>
                        </div>

                        <!-- Signature section -->
                        <div t-if="not o.signature" class="oe_structure"></div>
                        <div t-else="" class="mt-4 ml64 mr4" name="signature">
                            <div class="offset-8">
                                <strong>Signature</strong>
                            </div>
                            <div class="offset-8">
                                <img t-att-src="image_data_uri(o.signature)" style="max-height: 4cm; max-width: 8cm;"/>
                            </div>
                            <div t-if="o.partner_id.name" class="offset-8 text-center">
                                <p t-field="o.partner_id.name">John Doe</p>
                            </div>
                        </div>
                        
                        <!-- Order Notes -->
                        <div t-if="o.note" class="mt-3">
                            <strong>Order Notes:</strong>
                            <p t-field="o.note"/>
                        </div>
                    </div>
                </t>
            </t>
        </template>
    </data>
</odoo>